/* IPC using Pipe */
#include <stdio.h>
#include <stdlib.h>
#include <unistd.h>
#include <string.h>

int main() {
    int fd[2];
    pid_t pid;
    char write_msg[] = "Hello from Parent to Child via Pipe!";
    char read_msg[100];

    if (pipe(fd) == -1) {
        perror("pipe failed");
        exit(1);
    }

    pid = fork();

    if (pid < 0) {
        perror("fork failed");
        exit(1);
    }
    else if (pid == 0) { 
        // Child process
        close(fd[1]); // Close write end
        read(fd[0], read_msg, sizeof(read_msg));
        printf("Child received: %s\n", read_msg);
        close(fd[0]);
    }
    else { 
        // Parent process
        close(fd[0]); // Close read end
        write(fd[1], write_msg, strlen(write_msg) + 1);
        close(fd[1]);
        wait(NULL);
    }
    return 0;
}



/* IPC using Message Queue */
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <sys/ipc.h>
#include <sys/msg.h>

struct msg_buffer {
    long msg_type;
    char msg_text[100];
} message;

int main() {
    key_t key;
    int msgid;

    // Create unique key
    key = ftok("progfile", 65);

    // Create message queue
    msgid = msgget(key, 0666 | IPC_CREAT);

    message.msg_type = 1;

    printf("Write Data : ");
    fgets(message.msg_text, sizeof(message.msg_text), stdin);

    // Send message
    msgsnd(msgid, &message, sizeof(message), 0);

    printf("Data sent: %s\n", message.msg_text);

    // Receive message
    msgrcv(msgid, &message, sizeof(message), 1, 0);
    printf("Data received: %s\n", message.msg_text);

    // Destroy queue
    msgctl(msgid, IPC_RMID, NULL);

    return 0;
}


/* IPC using Shared Memory */
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <sys/ipc.h>
#include <sys/shm.h>

int main() {
    key_t key = ftok("shmfile",65);  // generate unique key
    int shmid = shmget(key, 1024, 0666|IPC_CREAT); // create shared memory

    char *str = (char*) shmat(shmid, (void*)0, 0);

    printf("Write Data: ");
    fgets(str, 1024, stdin);

    printf("Data written in memory: %s\n", str);

    shmdt(str); // detach

    // Now read from shared memory
    str = (char*) shmat(shmid, (void*)0, 0);
    printf("Data read from memory: %s\n", str);

    shmdt(str);
    shmctl(shmid, IPC_RMID, NULL); // destroy

    return 0;
}
